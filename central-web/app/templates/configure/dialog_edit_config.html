{% import "bootstrap/wtf.html" as wtf %}
<div id="config-dialog" class="modal" data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<a href="#" role="button" class="close cancel" aria-label="Close"><span aria-hidden="true">&times;</span></a>
{% if device_form %}
				<h4 class="modal-title">Edit Configuration '{{ config.name }}'</h4>
{% else %}
				<h4 class="modal-title">New Configuration</h4>
{% endif %}
			</div>
			<div class="modal-body">
				<form class="form" id="config_form" enctype="multipart/form-data" role="form">
					{{ config_form.hidden_tag() }}
					{{ wtf.form_errors(config_form, hiddens = "only") }}
					
					{{ wtf.form_field(config_form.name) }}
					{{ wtf.form_field(config_form.lockcode) }}
					{{ wtf.form_field(config_form.map_area_file) }}
					{{ wtf.form_field(config_form.map_area_filename, readonly = "readonly") }}
				</form>
{% if device_form %}
				<div id="expandable_area">
					<a	class="btn btn-primary" role="button" data-toggle="collapse" href="#config_modules"
						aria-expanded="false" aria-controls="config_modules">
						Modules
					</a>
					<a	class="btn btn-primary" role="button" data-toggle="collapse" href="#config_ping_alerts"
						aria-expanded="false" aria-controls="config_ping_alerts">
						Signal Alerts
					</a>
					<a	class="btn btn-primary" role="button" data-toggle="collapse" href="#config_voltage_alerts"
						aria-expanded="false" aria-controls="config_voltage_alerts">
						Voltage Alerts
					</a>
					<div class="collapse" id="config_modules">
						<h4 id="empty-devices-list" style="display:none">No module added yet!</h4>
						<table class="table table-hover table-condensed devices-list" style="display:none">
							<thead>
								<tr>
									<th></th>
									<th>Name</th>
									<th>Kind</th>
									<th>Device ID</th>
									<th>Voltage Threshold</th>
								</tr>
							</thead>
							<tbody>
							{% include "configure/all_module_rows.html" %}
							</tbody>
						</table>
						<div class="btn-group">
							<button id="create-device" type="button" class="btn btn-primary dropdown-toggle" 
								data-toggle="dropdown" aria-expanded="false">
								Add Module <span class="caret"></span>
							</button>
							<ul class="dropdown-menu" role="menu">
								<li>
									<a class="create-device" data-config="{{ config.id }}" data-kind="1" href="#">Add Keypad Module</a>
								</li>
								<li>
									<a class="create-device" data-config="{{ config.id }}" data-kind="2" href="#">Add Motion Detection Module</a>
								</li>
								<li>
									<a class="create-device" data-config="{{ config.id }}" data-kind="3" href="#">Add Camera Module</a>
								</li>
							</ul>
						</div>
						<form class="form form-inline" id="device_form" role="form" style="display:none">
						</form>
					</div>
					<div class="collapse" id="config_ping_alerts">
						<h4>Time (in seconds) without ping after which alerts must be triggered</h4>
						<ul class="list-group">
							{% include "configure/all_ping_alert_rows.html" %}
						</ul>
					</div>
					<div class="collapse" id="config_voltage_alerts">
						<h4>Rate (in % of device voltage threshold) under which alerts are triggered</h4>
						<ul class="list-group">
							{% include "configure/all_voltage_alert_rows.html" %}
						</ul>
					</div>
				</div>
{% endif %}
			</div>
			<div class="modal-footer">
				<a href="#" role="button" class="btn btn-default cancel">Cancel</a>
				{{ wtf.form_field(config_form.submit, button_map = {'config_submit': 'primary'}, form = "config_form") }}
			</div>
		</div>
	</div>
</div>
