{% import "forms.html" as forms %}
<div id="config-dialog" class="modal" data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<a href="#" role="button" class="close cancel" aria-label="Close"><span aria-hidden="true">&times;</span></a>
				<h4 class="modal-title" data-bind="text: isNew() ? 'New Configuration' : 'Edit Configuration \'' + name() + '\''"></h4>
			</div>
			<div class="modal-body">
				<form class="form" id="config_form" role="form" href="#">
					{{ forms.global_errors() }}
					{{ forms.input('name', 'Name', prefix = 'config_', required = 'required') }}
					{{ forms.input('lockcode', 'Lock Code', prefix = 'config_', required = 'required') }}

					{# TODO add errors if any on this field #}
					<div class="form-group">
						<label class="control-label" for="config_map_area">Monitored Zone Map</label>
						<div class="input-group">
							<input	class="form-control" type="text" 
									id="config_map_area_filename" name="config_map_area_filename" 
									data-bind="value: map_area_filename"
									readonly="readonly">
							<span class="input-group-btn">
								{# FIXME: cannot diasble a link! replace with button/input? #}
								<a class="btn btn-default" data-bind="click: showMapUpload">Select...</a> 
								<a class="btn btn-default" data-bind="enable: map_area_filename, click: deleteMap">Delete</a>
							</span>
						</div>
					</div>
				</form>
				{# Hidden form used just for the purpose of uploading the map file #}
				<form id="config_map_form" enctype="multipart/form-data" style="display: none">
					<input	id="map_area" name="map_area" type="file" accept=".svg" 
							data-bind="event: { change: mapUploadChanged }">
				</form>
				<!-- ko if: !isNew -->
				<div id="expandable_area">
					<a	class="btn btn-primary" role="button" data-toggle="collapse" href="#config_modules"
						aria-expanded="false" aria-controls="config_modules">
						Modules
					</a>
					<a	class="btn btn-primary" role="button" data-toggle="collapse" href="#config_ping_alerts"
						aria-expanded="false" aria-controls="config_ping_alerts">
						Signal Alerts
					</a>
					<a	class="btn btn-primary" role="button" data-toggle="collapse" href="#config_voltage_alerts"
						aria-expanded="false" aria-controls="config_voltage_alerts">
						Voltage Alerts
					</a>
{#
					<div class="collapse" id="config_modules">
						<h4 id="empty-devices-list" style="display:none">No module added yet!</h4>
						<table class="table table-hover table-condensed devices-list" style="display:none">
							<thead>
								<tr>
									<th></th>
									<th>Name</th>
									<th>Kind</th>
									<th>Device ID</th>
									<th>Voltage Threshold</th>
								</tr>
							</thead>
							<tbody>
							{% include "configure/all_module_rows.html" %}
							</tbody>
						</table>
						<div class="btn-group">
							<button id="create-device" type="button" class="btn btn-primary dropdown-toggle" 
								data-toggle="dropdown" aria-expanded="false">
								Add Module <span class="caret"></span>
							</button>
							<ul class="dropdown-menu" role="menu">
								<li>
									<a class="create-device" data-config="{{ config.id }}" data-kind="1" href="#">Add Keypad Module</a>
								</li>
								<li>
									<a class="create-device" data-config="{{ config.id }}" data-kind="2" href="#">Add Motion Detection Module</a>
								</li>
								<li>
									<a class="create-device" data-config="{{ config.id }}" data-kind="3" href="#">Add Camera Module</a>
								</li>
							</ul>
						</div>
						<form class="form form-inline" id="device_form" role="form" style="display:none">
						</form>
					</div>
					<div class="collapse" id="config_ping_alerts">
						<h4>Time (in seconds) without ping after which alerts must be triggered</h4>
						<ul class="list-group">
							{% include "configure/all_ping_alert_rows.html" %}
						</ul>
					</div>
					<div class="collapse" id="config_voltage_alerts">
						<h4>Rate (in % of device voltage threshold) under which alerts are triggered</h4>
						<ul class="list-group">
							{% include "configure/all_voltage_alert_rows.html" %}
						</ul>
					</div>
#}
				</div>
				<!-- /ko -->
			</div>
			<div class="modal-footer">
				<a href="#" role="button" class="btn btn-default cancel">Cancel</a>
				<!-- ko if: isNew -->
				<a href="#" role="button" class="btn btn-primary" id="config_submit" data-bind="click: saveNewConfig">Create Configuration</a>
				<!-- /ko -->
				<!-- ko ifnot: isNew -->
				<a href="#" role="button" class="btn btn-primary" id="config_submit" data-bind="click: saveConfig">Save Configuration</a>
				<!-- /ko -->
			</div>
		</div>
	</div>
</div>
